<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>node基础知识点总结 | 前端技术积累</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="该博客主要是用来记录自己的学习笔记，对自己的学习历程进行一个简单的记录，也会写一些深入总结性的博客。">
    
    <link rel="preload" href="/blog/assets/css/0.styles.84ac7da4.css" as="style"><link rel="preload" href="/blog/assets/js/app.1db59d1a.js" as="script"><link rel="preload" href="/blog/assets/js/2.b41a7aaa.js" as="script"><link rel="preload" href="/blog/assets/js/1.844c5b44.js" as="script"><link rel="preload" href="/blog/assets/js/189.1ff9e7fd.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.451e3122.js"><link rel="prefetch" href="/blog/assets/js/100.d9cb7c5b.js"><link rel="prefetch" href="/blog/assets/js/101.5cd72fe8.js"><link rel="prefetch" href="/blog/assets/js/102.8276d3aa.js"><link rel="prefetch" href="/blog/assets/js/103.6996f4f0.js"><link rel="prefetch" href="/blog/assets/js/104.e2a5a583.js"><link rel="prefetch" href="/blog/assets/js/105.1ab15095.js"><link rel="prefetch" href="/blog/assets/js/106.3d4e1246.js"><link rel="prefetch" href="/blog/assets/js/107.b641fb8e.js"><link rel="prefetch" href="/blog/assets/js/108.d404ad7e.js"><link rel="prefetch" href="/blog/assets/js/109.e4e6ef9a.js"><link rel="prefetch" href="/blog/assets/js/11.275e015e.js"><link rel="prefetch" href="/blog/assets/js/110.156a298b.js"><link rel="prefetch" href="/blog/assets/js/111.2732f532.js"><link rel="prefetch" href="/blog/assets/js/112.305d13cc.js"><link rel="prefetch" href="/blog/assets/js/113.8c5b6f1c.js"><link rel="prefetch" href="/blog/assets/js/114.17898182.js"><link rel="prefetch" href="/blog/assets/js/115.63b28225.js"><link rel="prefetch" href="/blog/assets/js/116.7d75a7ce.js"><link rel="prefetch" href="/blog/assets/js/117.fcb4cbdb.js"><link rel="prefetch" href="/blog/assets/js/118.7b91b6c9.js"><link rel="prefetch" href="/blog/assets/js/119.eb6f64e2.js"><link rel="prefetch" href="/blog/assets/js/12.5ef8c401.js"><link rel="prefetch" href="/blog/assets/js/120.088e0013.js"><link rel="prefetch" href="/blog/assets/js/121.6b93f16f.js"><link rel="prefetch" href="/blog/assets/js/122.e554b243.js"><link rel="prefetch" href="/blog/assets/js/123.d3593f9b.js"><link rel="prefetch" href="/blog/assets/js/124.5cc3ae1a.js"><link rel="prefetch" href="/blog/assets/js/125.80cac022.js"><link rel="prefetch" href="/blog/assets/js/126.171caedd.js"><link rel="prefetch" href="/blog/assets/js/127.dacac129.js"><link rel="prefetch" href="/blog/assets/js/128.4516a871.js"><link rel="prefetch" href="/blog/assets/js/129.3d915cae.js"><link rel="prefetch" href="/blog/assets/js/13.d6a8644e.js"><link rel="prefetch" href="/blog/assets/js/130.9f7bd10a.js"><link rel="prefetch" href="/blog/assets/js/131.a31ebc8d.js"><link rel="prefetch" href="/blog/assets/js/132.7ebddbb6.js"><link rel="prefetch" href="/blog/assets/js/133.e0d043eb.js"><link rel="prefetch" href="/blog/assets/js/134.3552152d.js"><link rel="prefetch" href="/blog/assets/js/135.b1bccae4.js"><link rel="prefetch" href="/blog/assets/js/136.6566363e.js"><link rel="prefetch" href="/blog/assets/js/137.36d6fb68.js"><link rel="prefetch" href="/blog/assets/js/138.09ffcf0f.js"><link rel="prefetch" href="/blog/assets/js/139.3e594ffd.js"><link rel="prefetch" href="/blog/assets/js/14.301d6740.js"><link rel="prefetch" href="/blog/assets/js/140.4a5c39ac.js"><link rel="prefetch" href="/blog/assets/js/141.22b7af73.js"><link rel="prefetch" href="/blog/assets/js/142.c94e2c68.js"><link rel="prefetch" href="/blog/assets/js/143.708afaa2.js"><link rel="prefetch" href="/blog/assets/js/144.0ac4b88f.js"><link rel="prefetch" href="/blog/assets/js/145.e050f975.js"><link rel="prefetch" href="/blog/assets/js/146.faae12c7.js"><link rel="prefetch" href="/blog/assets/js/147.a4863652.js"><link rel="prefetch" href="/blog/assets/js/148.7f2629f3.js"><link rel="prefetch" href="/blog/assets/js/149.44a02e92.js"><link rel="prefetch" href="/blog/assets/js/15.e5e5ebbd.js"><link rel="prefetch" href="/blog/assets/js/150.94add1c7.js"><link rel="prefetch" href="/blog/assets/js/151.f33bd838.js"><link rel="prefetch" href="/blog/assets/js/152.b2ae7eba.js"><link rel="prefetch" href="/blog/assets/js/153.8b874198.js"><link rel="prefetch" href="/blog/assets/js/154.82a18945.js"><link rel="prefetch" href="/blog/assets/js/155.fc4a6f90.js"><link rel="prefetch" href="/blog/assets/js/156.0a129127.js"><link rel="prefetch" href="/blog/assets/js/157.6c24a8e0.js"><link rel="prefetch" href="/blog/assets/js/158.11e158e2.js"><link rel="prefetch" href="/blog/assets/js/159.b357dc61.js"><link rel="prefetch" href="/blog/assets/js/16.b9d84ed4.js"><link rel="prefetch" href="/blog/assets/js/160.ef44d449.js"><link rel="prefetch" href="/blog/assets/js/161.d19d35f2.js"><link rel="prefetch" href="/blog/assets/js/162.690299af.js"><link rel="prefetch" href="/blog/assets/js/163.dd52bf81.js"><link rel="prefetch" href="/blog/assets/js/164.6a596ef0.js"><link rel="prefetch" href="/blog/assets/js/165.cbf84bb4.js"><link rel="prefetch" href="/blog/assets/js/166.18848cef.js"><link rel="prefetch" href="/blog/assets/js/167.d4a56c8c.js"><link rel="prefetch" href="/blog/assets/js/168.0cae0645.js"><link rel="prefetch" href="/blog/assets/js/169.7fe73c1d.js"><link rel="prefetch" href="/blog/assets/js/17.426156e8.js"><link rel="prefetch" href="/blog/assets/js/170.1ee706bc.js"><link rel="prefetch" href="/blog/assets/js/171.6495927b.js"><link rel="prefetch" href="/blog/assets/js/172.a896ed99.js"><link rel="prefetch" href="/blog/assets/js/173.5015228d.js"><link rel="prefetch" href="/blog/assets/js/174.b345c0b3.js"><link rel="prefetch" href="/blog/assets/js/175.0c14910b.js"><link rel="prefetch" href="/blog/assets/js/176.d40b59bf.js"><link rel="prefetch" href="/blog/assets/js/177.ada5200a.js"><link rel="prefetch" href="/blog/assets/js/178.fd6f5988.js"><link rel="prefetch" href="/blog/assets/js/179.74ad5ac6.js"><link rel="prefetch" href="/blog/assets/js/18.fde64886.js"><link rel="prefetch" href="/blog/assets/js/180.c777d2b2.js"><link rel="prefetch" href="/blog/assets/js/181.169686a0.js"><link rel="prefetch" href="/blog/assets/js/182.9389ba06.js"><link rel="prefetch" href="/blog/assets/js/183.eb09bc5d.js"><link rel="prefetch" href="/blog/assets/js/184.c4b91aab.js"><link rel="prefetch" href="/blog/assets/js/185.197fad4c.js"><link rel="prefetch" href="/blog/assets/js/186.a9085711.js"><link rel="prefetch" href="/blog/assets/js/187.1e6e865c.js"><link rel="prefetch" href="/blog/assets/js/188.548563ab.js"><link rel="prefetch" href="/blog/assets/js/19.cf392fb0.js"><link rel="prefetch" href="/blog/assets/js/190.181d189c.js"><link rel="prefetch" href="/blog/assets/js/191.0809f85a.js"><link rel="prefetch" href="/blog/assets/js/192.074e82e0.js"><link rel="prefetch" href="/blog/assets/js/193.aff43155.js"><link rel="prefetch" href="/blog/assets/js/194.936bb078.js"><link rel="prefetch" href="/blog/assets/js/195.3016e44e.js"><link rel="prefetch" href="/blog/assets/js/196.f5d931c6.js"><link rel="prefetch" href="/blog/assets/js/197.e2a185c4.js"><link rel="prefetch" href="/blog/assets/js/198.668ff176.js"><link rel="prefetch" href="/blog/assets/js/199.ca01d011.js"><link rel="prefetch" href="/blog/assets/js/20.8a7ffb7e.js"><link rel="prefetch" href="/blog/assets/js/200.17032440.js"><link rel="prefetch" href="/blog/assets/js/201.4714c2f6.js"><link rel="prefetch" href="/blog/assets/js/202.dfcdd2f5.js"><link rel="prefetch" href="/blog/assets/js/203.db77aee1.js"><link rel="prefetch" href="/blog/assets/js/204.7a03df4e.js"><link rel="prefetch" href="/blog/assets/js/205.a1e1eedf.js"><link rel="prefetch" href="/blog/assets/js/206.9b281463.js"><link rel="prefetch" href="/blog/assets/js/207.61452e78.js"><link rel="prefetch" href="/blog/assets/js/208.1cd40d05.js"><link rel="prefetch" href="/blog/assets/js/209.e2ed3b73.js"><link rel="prefetch" href="/blog/assets/js/21.66230dbc.js"><link rel="prefetch" href="/blog/assets/js/210.3a31c883.js"><link rel="prefetch" href="/blog/assets/js/211.a8d631c2.js"><link rel="prefetch" href="/blog/assets/js/212.fb950ad4.js"><link rel="prefetch" href="/blog/assets/js/213.e7f30b64.js"><link rel="prefetch" href="/blog/assets/js/214.d7efe0dc.js"><link rel="prefetch" href="/blog/assets/js/215.491070b6.js"><link rel="prefetch" href="/blog/assets/js/216.8799dabf.js"><link rel="prefetch" href="/blog/assets/js/217.c178fbd2.js"><link rel="prefetch" href="/blog/assets/js/218.bd8a870b.js"><link rel="prefetch" href="/blog/assets/js/219.3fcaa625.js"><link rel="prefetch" href="/blog/assets/js/22.e6487b68.js"><link rel="prefetch" href="/blog/assets/js/220.9c91d53e.js"><link rel="prefetch" href="/blog/assets/js/221.a776ebf8.js"><link rel="prefetch" href="/blog/assets/js/222.68b39a31.js"><link rel="prefetch" href="/blog/assets/js/223.275a6954.js"><link rel="prefetch" href="/blog/assets/js/224.9f70e062.js"><link rel="prefetch" href="/blog/assets/js/225.afdf582d.js"><link rel="prefetch" href="/blog/assets/js/226.a928065b.js"><link rel="prefetch" href="/blog/assets/js/227.e2b719af.js"><link rel="prefetch" href="/blog/assets/js/228.947d47ec.js"><link rel="prefetch" href="/blog/assets/js/229.412593a9.js"><link rel="prefetch" href="/blog/assets/js/23.728862cb.js"><link rel="prefetch" href="/blog/assets/js/230.61f7bcea.js"><link rel="prefetch" href="/blog/assets/js/231.f8301029.js"><link rel="prefetch" href="/blog/assets/js/232.0a4869e0.js"><link rel="prefetch" href="/blog/assets/js/233.b9d4eb5f.js"><link rel="prefetch" href="/blog/assets/js/234.7d0c3878.js"><link rel="prefetch" href="/blog/assets/js/235.f0facffe.js"><link rel="prefetch" href="/blog/assets/js/236.69007e3b.js"><link rel="prefetch" href="/blog/assets/js/237.aaa4eae6.js"><link rel="prefetch" href="/blog/assets/js/238.863fff6e.js"><link rel="prefetch" href="/blog/assets/js/239.7de07247.js"><link rel="prefetch" href="/blog/assets/js/24.5b42a58b.js"><link rel="prefetch" href="/blog/assets/js/240.7eb2c9a8.js"><link rel="prefetch" href="/blog/assets/js/241.0f1a7f6c.js"><link rel="prefetch" href="/blog/assets/js/242.5002b6be.js"><link rel="prefetch" href="/blog/assets/js/243.04abd966.js"><link rel="prefetch" href="/blog/assets/js/244.6fc42a7b.js"><link rel="prefetch" href="/blog/assets/js/245.14198d08.js"><link rel="prefetch" href="/blog/assets/js/246.737c3a6d.js"><link rel="prefetch" href="/blog/assets/js/247.1a22f460.js"><link rel="prefetch" href="/blog/assets/js/248.d2e0872b.js"><link rel="prefetch" href="/blog/assets/js/249.69a7ba80.js"><link rel="prefetch" href="/blog/assets/js/25.c08f1aa9.js"><link rel="prefetch" href="/blog/assets/js/250.48d94104.js"><link rel="prefetch" href="/blog/assets/js/251.4d249837.js"><link rel="prefetch" href="/blog/assets/js/252.a9220279.js"><link rel="prefetch" href="/blog/assets/js/253.a18275ad.js"><link rel="prefetch" href="/blog/assets/js/254.832ea0ff.js"><link rel="prefetch" href="/blog/assets/js/255.7edbdfaa.js"><link rel="prefetch" href="/blog/assets/js/256.14fbf143.js"><link rel="prefetch" href="/blog/assets/js/257.0d140120.js"><link rel="prefetch" href="/blog/assets/js/258.08776a25.js"><link rel="prefetch" href="/blog/assets/js/259.8e4cf688.js"><link rel="prefetch" href="/blog/assets/js/26.f8675b42.js"><link rel="prefetch" href="/blog/assets/js/260.ed16eda6.js"><link rel="prefetch" href="/blog/assets/js/261.368fa50b.js"><link rel="prefetch" href="/blog/assets/js/262.84011805.js"><link rel="prefetch" href="/blog/assets/js/263.00f7de13.js"><link rel="prefetch" href="/blog/assets/js/264.670ee38a.js"><link rel="prefetch" href="/blog/assets/js/265.4990a4ff.js"><link rel="prefetch" href="/blog/assets/js/266.8f2a28af.js"><link rel="prefetch" href="/blog/assets/js/267.83b67f95.js"><link rel="prefetch" href="/blog/assets/js/268.7bc53a08.js"><link rel="prefetch" href="/blog/assets/js/269.63c7b5b4.js"><link rel="prefetch" href="/blog/assets/js/27.c504ebf1.js"><link rel="prefetch" href="/blog/assets/js/270.ca56b372.js"><link rel="prefetch" href="/blog/assets/js/271.96a6909d.js"><link rel="prefetch" href="/blog/assets/js/272.32ccfb2d.js"><link rel="prefetch" href="/blog/assets/js/273.0abb245f.js"><link rel="prefetch" href="/blog/assets/js/274.201d4dfb.js"><link rel="prefetch" href="/blog/assets/js/275.2537b0b3.js"><link rel="prefetch" href="/blog/assets/js/276.4fefa1b2.js"><link rel="prefetch" href="/blog/assets/js/277.fc7b390d.js"><link rel="prefetch" href="/blog/assets/js/28.325b56ef.js"><link rel="prefetch" href="/blog/assets/js/29.5d34d63b.js"><link rel="prefetch" href="/blog/assets/js/3.5ec6aa97.js"><link rel="prefetch" href="/blog/assets/js/30.742dcbdb.js"><link rel="prefetch" href="/blog/assets/js/31.e393e686.js"><link rel="prefetch" href="/blog/assets/js/32.371528bc.js"><link rel="prefetch" href="/blog/assets/js/33.7d5deb80.js"><link rel="prefetch" href="/blog/assets/js/34.7416f322.js"><link rel="prefetch" href="/blog/assets/js/35.b8c0b89a.js"><link rel="prefetch" href="/blog/assets/js/36.da6d5f98.js"><link rel="prefetch" href="/blog/assets/js/37.f62662a0.js"><link rel="prefetch" href="/blog/assets/js/38.c8fe60d1.js"><link rel="prefetch" href="/blog/assets/js/39.6287c952.js"><link rel="prefetch" href="/blog/assets/js/4.048aff81.js"><link rel="prefetch" href="/blog/assets/js/40.6a022cd3.js"><link rel="prefetch" href="/blog/assets/js/41.080260ac.js"><link rel="prefetch" href="/blog/assets/js/42.b688cbd9.js"><link rel="prefetch" href="/blog/assets/js/43.2c2beeb1.js"><link rel="prefetch" href="/blog/assets/js/44.ce218100.js"><link rel="prefetch" href="/blog/assets/js/45.5857176b.js"><link rel="prefetch" href="/blog/assets/js/46.0f2d8a68.js"><link rel="prefetch" href="/blog/assets/js/47.9381366c.js"><link rel="prefetch" href="/blog/assets/js/48.17bfa7cb.js"><link rel="prefetch" href="/blog/assets/js/49.e53e5005.js"><link rel="prefetch" href="/blog/assets/js/5.ca184b2f.js"><link rel="prefetch" href="/blog/assets/js/50.2a1d44ee.js"><link rel="prefetch" href="/blog/assets/js/51.f44e790c.js"><link rel="prefetch" href="/blog/assets/js/52.9a65afc7.js"><link rel="prefetch" href="/blog/assets/js/53.d222faa4.js"><link rel="prefetch" href="/blog/assets/js/54.5239ce4c.js"><link rel="prefetch" href="/blog/assets/js/55.94746353.js"><link rel="prefetch" href="/blog/assets/js/56.94247605.js"><link rel="prefetch" href="/blog/assets/js/57.310c2236.js"><link rel="prefetch" href="/blog/assets/js/58.ee8b3fff.js"><link rel="prefetch" href="/blog/assets/js/59.a290fd3a.js"><link rel="prefetch" href="/blog/assets/js/6.41edf020.js"><link rel="prefetch" href="/blog/assets/js/60.b6d15838.js"><link rel="prefetch" href="/blog/assets/js/61.45ff1cd8.js"><link rel="prefetch" href="/blog/assets/js/62.3e678827.js"><link rel="prefetch" href="/blog/assets/js/63.3413a854.js"><link rel="prefetch" href="/blog/assets/js/64.8527fa66.js"><link rel="prefetch" href="/blog/assets/js/65.bf893868.js"><link rel="prefetch" href="/blog/assets/js/66.a38085e0.js"><link rel="prefetch" href="/blog/assets/js/67.760d6de8.js"><link rel="prefetch" href="/blog/assets/js/68.a6ed7d42.js"><link rel="prefetch" href="/blog/assets/js/69.48ab5d68.js"><link rel="prefetch" href="/blog/assets/js/7.b1bf34b0.js"><link rel="prefetch" href="/blog/assets/js/70.d5661721.js"><link rel="prefetch" href="/blog/assets/js/71.8f65872b.js"><link rel="prefetch" href="/blog/assets/js/72.d08b2ec6.js"><link rel="prefetch" href="/blog/assets/js/73.4f86a6c7.js"><link rel="prefetch" href="/blog/assets/js/74.68b083a5.js"><link rel="prefetch" href="/blog/assets/js/75.c7c7de89.js"><link rel="prefetch" href="/blog/assets/js/76.4e502d29.js"><link rel="prefetch" href="/blog/assets/js/77.3c852431.js"><link rel="prefetch" href="/blog/assets/js/78.80356d4f.js"><link rel="prefetch" href="/blog/assets/js/79.5d54bd1c.js"><link rel="prefetch" href="/blog/assets/js/80.d1068470.js"><link rel="prefetch" href="/blog/assets/js/81.092b0805.js"><link rel="prefetch" href="/blog/assets/js/82.f8a3a07c.js"><link rel="prefetch" href="/blog/assets/js/83.f1b46b76.js"><link rel="prefetch" href="/blog/assets/js/84.48b0f5cb.js"><link rel="prefetch" href="/blog/assets/js/85.1d27a232.js"><link rel="prefetch" href="/blog/assets/js/86.79205bef.js"><link rel="prefetch" href="/blog/assets/js/87.e30298a6.js"><link rel="prefetch" href="/blog/assets/js/88.fc9e5e5b.js"><link rel="prefetch" href="/blog/assets/js/89.774f4e51.js"><link rel="prefetch" href="/blog/assets/js/90.b0649f58.js"><link rel="prefetch" href="/blog/assets/js/91.388f7793.js"><link rel="prefetch" href="/blog/assets/js/92.4200ddc0.js"><link rel="prefetch" href="/blog/assets/js/93.bc88d022.js"><link rel="prefetch" href="/blog/assets/js/94.2676bb86.js"><link rel="prefetch" href="/blog/assets/js/95.9cfd185d.js"><link rel="prefetch" href="/blog/assets/js/96.2b6dd4aa.js"><link rel="prefetch" href="/blog/assets/js/97.c6b9bb42.js"><link rel="prefetch" href="/blog/assets/js/98.9275062d.js"><link rel="prefetch" href="/blog/assets/js/99.6749df14.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.ba560735.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.84ac7da4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">前端技术积累</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/timeline/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术栈" class="dropdown-title"><span class="title">技术栈</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术栈" class="mobile-dropdown-title"><span class="title">技术栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/es6/" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/http/" class="nav-link">
  http
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/javascript/" class="nav-link">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/jquery-source-analysis/" class="nav-link">
  jquery-source-analysis
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/linux/" class="nav-link">
  linux
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/node/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  node
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/threejs/" class="nav-link">
  threejs
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/typescript/" class="nav-link">
  typescript
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/vue3/" class="nav-link">
  vue3
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/webgl/" class="nav-link">
  webgl
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/其他/" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/算法/" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><a href="/blog/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="/blog/tags/" class="nav-link">
  标签
</a></div><div class="nav-item"><a href="/blog/comments/" class="nav-link">
  留言板
</a></div><div class="nav-item"><a href="/blog/summarize/" class="nav-link">
  充电站
</a></div><div class="nav-item"><a href="https://juejin.im/user/5bd074165188251ce71d8e2c" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/tangjie-93/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/timeline/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术栈" class="dropdown-title"><span class="title">技术栈</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术栈" class="mobile-dropdown-title"><span class="title">技术栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/articles/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/es6/" class="nav-link">
  es6
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/http/" class="nav-link">
  http
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/javascript/" class="nav-link">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/jquery-source-analysis/" class="nav-link">
  jquery-source-analysis
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/linux/" class="nav-link">
  linux
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/node/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  node
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/threejs/" class="nav-link">
  threejs
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/typescript/" class="nav-link">
  typescript
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/vue3/" class="nav-link">
  vue3
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/webgl/" class="nav-link">
  webgl
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/其他/" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="/blog/articles/算法/" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><a href="/blog/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="/blog/tags/" class="nav-link">
  标签
</a></div><div class="nav-item"><a href="/blog/comments/" class="nav-link">
  留言板
</a></div><div class="nav-item"><a href="/blog/summarize/" class="nav-link">
  充电站
</a></div><div class="nav-item"><a href="https://juejin.im/user/5bd074165188251ce71d8e2c" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/tangjie-93/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/blog/articles/node/" aria-current="page" class="active sidebar-link">node基础知识点总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/articles/node/#第一节-node概述" class="sidebar-link">第一节  node概述</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#第二节-node模块介绍" class="sidebar-link">第二节  Node模块介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/articles/node/#_1、assert" class="sidebar-link">1、assert()</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_2、buffer" class="sidebar-link">2、Buffer</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_3、child-process模块" class="sidebar-link">3、Child Process模块</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_4、cluster" class="sidebar-link">4、cluster</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_5、event" class="sidebar-link">5、Event</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_6、express" class="sidebar-link">6、express</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_9、os模块" class="sidebar-link">9、os模块</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_10、process对象" class="sidebar-link">10、process对象</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_11、url" class="sidebar-link">11、url</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_12、querystring" class="sidebar-link">12、querystring</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_13、stream" class="sidebar-link">13、stream</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_14、net模块和dns模块" class="sidebar-link">14、Net模块和DNS模块</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_15、commonjs规范" class="sidebar-link">15、CommonJS规范</a></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#_16、npm包管理器" class="sidebar-link">16、npm包管理器</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/articles/node/#第三节-其它" class="sidebar-link">第三节 其它</a></li></ul></li><li><a href="/blog/articles/node/egg源码实现.html" class="sidebar-link">egg源码实现</a></li><li><a href="/blog/articles/node/koa用法及源码详解及手写实现.html" class="sidebar-link">koa用法及源码详解</a></li><li><a href="/blog/articles/node/从零实现一个脚手架.html" class="sidebar-link">从零实现一个脚手架</a></li><li><a href="/blog/articles/node/怎么获取客户端的ip地址？.html" class="sidebar-link">怎么获取客户端的ip地址？</a></li><li><a href="/blog/articles/node/核心模块fs详解.html" class="sidebar-link">核心模块fs详解</a></li><li><a href="/blog/articles/node/核心模块http详解.html" class="sidebar-link">核心模块http详解</a></li><li><a href="/blog/articles/node/核心模块path详解.html" class="sidebar-link">核心模块path详解</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="第一节-node概述"><a href="#第一节-node概述" class="header-anchor">#</a> 第一节  node概述</h2> <p>  Node为服务端JavaScript提供了一个事件驱动的、异步的平台。 专为数据密集型实时程序设计的。 node中的模块一旦被加载以后，就会被系统缓存。第二次加载该模块时，是从缓存中加载的。如果希望模块执行多次，则可以让函数返回一个函数，然后多次调用该函数。<br></p> <p>​<strong>node的优势?</strong></p> <ul><li>1、对于文件读写，采用的是<code>非阻塞异步IO</code>（input、output）。</li> <li>2、传统IO在读写文件的时候采用CPU处理，代码执行也处于等待中，浪费性能。</li> <li>3、非阻塞IO将读写操作交给CPU，而代码正常执行，减少等待浪费的性能。</li> <li>4、事件驱动，用事件驱动来完成服务器的任务调度。</li> <li>5、跨平台 能够在linux和window平台上有运行。Node是基于<code>libuv</code>实现跨平台的。</li></ul> <p><strong>node的不足</strong></p> <ul><li><p>1、无法利用多核cpu<br> <strong>解决方案</strong></p> <ul><li>1、<code>pm2、nodemon</code>等工具都可以实现创建多进程解决多核cpu的利用率问题。</li> <li>2、在v0.8之前，实现多进程可以使用<code>child_process</code>。</li> <li>3、在v0.8之后，可以使用<code>cluster</code>模块，创建多个工作进程来解决多核CPU的利用率问题。</li></ul></li> <li><p>2、错误会引起整个应用退出无法继续调用异步<code>I/O</code><br> <strong>解决方案</strong></p> <ul><li>1、Nginx反向代理、负载均衡，开启多个进程，绑定多个端口。</li> <li>2、<code>pm2、forever</code>等进程管理工具可以实现进程监控，错误自动重启。</li> <li>3、开多个进程监听同一端口，使用node提供的<code>cluster</code>或者<code>child_process</code>模块。</li> <li>4、使用<code>try catch</code>,抓取错误。</li></ul></li> <li><p>3、大量计算占用CPU导致无法继续调用异步<code>I/O</code><br> <strong>解决方案</strong></p> <ul><li>1、将大量的密集计算拆分成多个子进程进行计算。</li></ul></li></ul> <p><strong>应用场景：</strong></p> <ul><li>1、实际应用：<code>webpack、gulp、npm、http-server、json-server</code></li> <li>2、服务器中负责<code>IO</code>读写的中间层服务器。</li></ul> <p><strong>Node特点</strong></p> <ul><li>1、移植了<code>chromeV8</code>引擎，解析和执行代码机制和浏览器js相同。</li> <li>2、沿用了js语法，另外扩展了自己需要的功能。</li> <li>3、nodejs是后台语言，其具备操作文件的能力，可以具备服务器的创建和操作能力。</li></ul> <p><strong>1、全局对象</strong></p> <ul><li>global: <code>Node所在的全局环境</code>。</li> <li>process: <code>该对象表示Node所处的当前进程</code>.<code>process.env</code>是一个对象，可以通过其.属性名来获取具体的环境变量。<code>proces.argv</code>获取命令行参数(<code>['node绝对路径'，'文件的绝对路径'，'参数1','参数2'，...]</code>)。</li> <li>console: <code>输入输出标准</code>。</li></ul> <p><strong>2、全局变量</strong><br></p> <ul><li>__filename: <code>指向当前运行的脚本文件名</code>。<br></li> <li>__dirname: <code>指向当前运行的脚本所在的目录</code>。</li></ul> <p><strong>3、核心模块</strong></p> <ul><li>http：提供http服务器功能。</li> <li>url：解析url。</li> <li>fs：文本系统交互。</li> <li>querystring：解析URL的查询字符串。</li> <li>child_process：新建子进程。</li> <li>util：提供的一系列使用小工具。</li> <li>path：处理文件路径。</li> <li>crypto：提供加密和解密功能，基本上是对OpenSSL的包装。</li></ul> <p><strong>4、异常处理</strong></p> <p>  Node有三种方法来传递一个错误。</p> <blockquote><p>1、使用throw语句来抛出一个错误对象。<br>
2、将错误对象传递给回调函数。<br>
3、通过EventEmitter接口，来发出一个事件。</p></blockquote> <ul><li>1、try...catch:
无法捕获异步运行的代码抛出的错误。解决方法：将错误捕获代码，也放到异步执行。（如解析JSON.parse）</li> <li>2、回调函数</li></ul> <p>  node采用的方法，是将错误对象作为第一个参数传入回调函数。这样能避免捕获代码与发生错误的代码不在同一个时间段的问题。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;/foo.txt&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>3、EventEmitter接口的error事件</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>EventEmitter<span class="token punctuation">;</span>
    <span class="token keyword">var</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//触发error事件</span>
    emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'something bad happened'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//监听error错误</span>
    emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'出错：'</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>  当一个异常违未被捕获，会触发uncaughtException事件。异常的上下文已经丢失，异常可能导致Node不能正常进行内存回收，出现内存泄露并记录错误日志，然后结束node进程。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tracer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">console</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uncaughtException'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>4、unhandledRejection事件</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Broken.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">//上面的错误抛出后不会有任何反应。通过监听unhandledRejection事件，就能解决这个问题。</span>
    process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'unhandledRejection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//err是错误对象，p是产生错误的promise对象。</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="第二节-node模块介绍"><a href="#第二节-node模块介绍" class="header-anchor">#</a> 第二节  Node模块介绍</h2> <h3 id="_1、assert"><a href="#_1、assert" class="header-anchor">#</a> <strong>1、assert()</strong></h3> <p>  主要用于断言。如果表达式不符合预期，就抛出一个错误。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    assert<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    assert<span class="token punctuation">.</span><span class="token function">notEqual</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    assert<span class="token punctuation">.</span><span class="token function">deepEqual</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    assert<span class="token punctuation">.</span><span class="token function">notDeepEqual</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    assert<span class="token punctuation">.</span><span class="token function">strictEqual</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    assert<span class="token punctuation">.</span><span class="token function">notStrictEqual</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    assert<span class="token punctuation">.</span><span class="token function">throws</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    assert<span class="token punctuation">.</span><span class="token function">doesNotThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    assert<span class="token punctuation">.</span><span class="token function">ifError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    assert<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_2、buffer"><a href="#_2、buffer" class="header-anchor">#</a> <strong>2、Buffer</strong></h3> <p>  Buffer对象是Node处理二进制数据(如TCP数据流)的一个接口。它是Node原生提供的全局对象，可以直接使用，不需要require('buffer')。它是一个构造函数，生成的实例代表了V8引擎分配的一段内存，是一个类似数组的对象，成员都为0到255的整数值，即一个8位的字节。</p> <p><strong> 2.1、Buffer对象的直接赋值和取值</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">// 生成一个256字节的Buffer实例</span>
    <span class="token keyword">var</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 遍历每个字节，写入内容</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 生成一个buffer的view</span>
    <span class="token comment">// 从240字节到256字节</span>
    <span class="token keyword">var</span> end <span class="token operator">=</span> bytes<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//slice方法创造原内存的一个视图</span>
    end<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// 240</span>
    end<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    end<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// 0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong> 2.2、Buffer实例的拷贝生成</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> more <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bytes<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>more<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    more<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// 4</span>
    copy方法将bytes实例的<span class="token number">4</span>号成员到<span class="token number">7</span>号成员的这一段，都拷贝到了more实例从<span class="token number">0</span>号成员开始的区域。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong> 2.3、Buffer构造函数</strong></p> <p>  用new命令生成一个实例，它可以接受多种形式的参数。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">// 参数是整数，指定分配多少个字节内存</span>
    <span class="token keyword">var</span> hello <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 参数是数组，数组成员必须是整数值</span>
    <span class="token keyword">var</span> hello <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x6c</span><span class="token punctuation">,</span> <span class="token number">0x6c</span><span class="token punctuation">,</span> <span class="token number">0x6f</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hello<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'Hello'</span>

    <span class="token comment">// 参数是字符串（默认为utf8编码）</span>
    <span class="token keyword">var</span> hello <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hello<span class="token punctuation">.</span>length <span class="token comment">// 5</span>
    hello<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;Hello&quot;</span>

    <span class="token comment">// 参数是字符串（不省略编码）</span>
    <span class="token keyword">var</span> hello <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 参数是另一个Buffer实例，等同于拷贝后者</span>
    <span class="token keyword">var</span> hello1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> hello2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>hello1<span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong> 2.4、Buffer类的方法</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    Buffer<span class="token punctuation">.</span><span class="token function">isEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：返回一个布尔值，表示Buffer实例是否为指定编码。
    Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：接受一个对象作为参数，返回一个布尔值，表示该对象是否为Buffer实例。
    Buffer<span class="token punctuation">.</span><span class="token function">byteLength</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token comment">// 5 返回字符串实际占据的字节长度，默认编码方式为utf8。</span>
    Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//将一组Buffer对象合并为一个Buffer对象。</span>
    <span class="token keyword">var</span> i1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> i2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> i3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i1<span class="token punctuation">,</span> i2<span class="token punctuation">,</span> i3<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 'Hello Worl'</span>
    <span class="token comment">//如果Buffer.concat的参数数组只有一个成员，就直接返回该成员。如果有多个成员，就返回一个多个成员合并的新Buffer对象。Buffer.concat方法还可以接受第二个参数，指定合并后Buffer对象的总长度。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong> 2.5、实例属性</strong></p> <p>   length：返回Buffer对象所占据的内存长度。注意，这个值与Buffer对象的内容无关。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buf<span class="token punctuation">.</span>length <span class="token comment">// 1234</span>
    buf<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;some string&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;ascii&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buf<span class="token punctuation">.</span>length <span class="token comment">// 1234</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong> 2.6、实例方法</strong></p> <p>  write():可以向指定的Buffer对象写入数据。它的第一个参数是所写入的内容，第二个参数（可省略）是所写入的起始位置（默认从0开始），第三个参数（可省略）是编码方式，默认为utf8。<br>
  slice():返回一个按照指定位置、从原对象切割出来的Buffer实例。它的两个参数分别为切割的起始位置和终止位置。<br>
  toString()：将Buffer实例，按照指定编码（默认为utf8）转为字符串。toString方法可以只返回指定位置内存的内容，它的第二个参数表示起始位置，第三个参数表示终止位置，两者都是从0开始计算。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'just some data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// &quot;some&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>  toJSON():将Buffer实例转为JSON对象。如果JSON.stringify方法调用Buffer实例，默认会先调用toJSON方法。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    json <span class="token comment">// '[116,101,115,116]'</span>

    <span class="token keyword">var</span> copy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    copy <span class="token comment">// &lt;Buffer 74 65 73 74&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3、child-process模块"><a href="#_3、child-process模块" class="header-anchor">#</a> <strong>3、Child Process模块</strong></h3> <p>  child_process模块用于新建子进程。子进程的运行结果储存在系统缓存之中（最大200KB），等到子进程运行结束以后，主进程再用回调函数读取子进程的运行结果。<br></p> <p><strong> 3.1、主要方法</strong></p> <ul><li>1、exec()</li></ul> <p>  用于执行bash命令，它的参数是一个命令字符串。最多可以接受两个参数，第一个参数是所要执行的shell命令，第二个参数是回调函数，该函数接受三个参数，分别是发生的错误、标准输出的显示结果、标准错误的显示结果。exec方法会直接调用bash（/bin/sh程序）来解释命令，所以如果有用户输入的参数，exec方法是不安全的。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> exec <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exec<span class="token punctuation">;</span>
    <span class="token keyword">var</span> ls <span class="token operator">=</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'ls -l'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error code: '</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Child Process STDOUT: '</span> <span class="token operator">+</span> stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    由于标准输出和标准错误都是流对象（stream），可以监听data事件，因此上面的代码也可以写成下面这样。
    <span class="token comment">//推荐写法</span>
    <span class="token keyword">var</span> exec <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exec<span class="token punctuation">;</span>
    <span class="token keyword">var</span> child <span class="token operator">=</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'ls -l'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    child<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'stdout: '</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    child<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'stdout: '</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    child<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'closing code: '</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li>2、execSync()</li></ul> <p>  是exec的同步执行版本。它可以接受两个参数，第一个参数是所要执行的命令，第二个参数用来配置执行环境。</p> <ul><li>3、execFile()</li></ul> <p>  直接执行特定的程序，参数作为数组传入，不会被bash解释，因此具有较高的安全性。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">;</span>
    child_process<span class="token punctuation">.</span><span class="token function">execFile</span><span class="token punctuation">(</span><span class="token string">'/bin/ls'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'-l'</span><span class="token punctuation">,</span> path<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>4、spawn()</li></ul> <p>  创建一个子进程来执行特定命令，用法与execFile方法类似，但是没有回调函数，只能通过监听事件，来获取运行结果。它属于异步执行，适用于子进程长时间运行的情况。<br>
  spawn方法接受两个参数，第一个是可执行文件，第二个是参数数组。<br>
  spawn对象返回一个对象，代表子进程。该对象部署了EventEmitter接口，它的data事件可以监听，从而得到子进程的输出结果。<br>
  spawn方法与exec方法非常类似，只是使用格式略有区别。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    child_process<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
    child_process<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token punctuation">[</span>args<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token string">'.'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> ls <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'/bin/ls'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'-l'</span><span class="token punctuation">,</span> path<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ls<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'stdout: '</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ls<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'stderr: '</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ls<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child process exited with code '</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>5、fork()</li></ul> <p>  直接创建一个子进程，执行Node脚本，fork('./child.js') 相当于 spawn('node', ['./child.js']) 。与spawn方法不同的是，fork会在父进程与子进程之间，建立一个通信管道，用于进程之间的通信。<br>
  fork方法返回一个代表进程间通信管道的对象，对该对象可以监听message事件，用来获取子进程返回的信息，也可以向子进程发送信息。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> n <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token string">'./child.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    n<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'PARENT got message:'</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    n<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">'world'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//child.js</span>
    process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'CHILD got message:'</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>6、send()</li></ul> <p>  使用 child_process.fork() 生成新进程之后，就可以用 child.send(message, [sendHandle]) 向新进程发送消息。新进程中通过监听message事件，来获取消息。</p> <h3 id="_4、cluster"><a href="#_4、cluster" class="header-anchor">#</a> <strong>4、cluster</strong></h3> <p>  集群模块允许设立一个主进程和若干个工人进程，由主进程监控和协调工人进程的运行。worker之间采用进程间通信交换消息，集群模块内置一个负载均衡器，采用循环赛算法协调各个工人进程之间的负载运行。所有新建立的链接都由主进程完成，然后主进程再把TCP连接分配给指定的工人进程。</p> <p><strong> 4.1、worker对象</strong></p> <p>  是cluster.fork()的返回值，代表一个worker进程。有如下属性：</p> <p>  1、workid：是cluster.workers中指向当前进程的索引值。<br>
  2、worker.process：所有的worker进程都是用child_process.fork()生成的。child_process.fork()返回的对象，被保存在work.process之中。通过这个属性，可以获取worker所在的进程对象。<br>
  3、work.send()：用于在主进程中，向子进程发送信息。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cluster<span class="token punctuation">.</span>isMaster<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> worker <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            worker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hi there'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cluster<span class="token punctuation">.</span>isWorker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//监听主进程的消息。</span>
        process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            process<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong> 4.2、cluster.workers对象</strong></p> <p>  只有主进程才有，包含了所有worker进程。每个成员的键值就是一个worker进程对象，键名就是该worker进程的worker.id属性。</p> <p><strong> 4.3、cluster模块的属性和方法</strong></p> <ul><li>1、isWorker、isMaster</li></ul> <p>  属性由process.env.NODE_UNIQUE_ID决定，如果process.env.NODE_UNIQUE_ID为未定义，就表示该进程是主进程。</p> <ul><li>2、fork()</li></ul> <p>  用于创建一个worker进程，上下文都是复制主进程。只有主进程才能调用这个方法。</p> <ul><li>3、kill()</li></ul> <p>  终止worker进程。如果当前是主进程，就会终止与worker.process的联络，然后将系统信号法发向worker进程。如果当前是worker进程，就会终止与主进程的通信，然后退出，返回0。</p> <ul><li>4、listening事件</li></ul> <p>  worker进程调用listening方法以后，“listening”事件就传向该进程的服务器，然后传向主进程。</p> <p>  该事件的回调函数接受两个参数，一个是当前worker对象，另一个是地址对象，包含网址、端口、地址类型（IPv4、IPv6、Unix socket、UDP）等信息。这对于那些服务多个网址的Node应用程序非常有用。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    cluster<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'listening'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">worker<span class="token punctuation">,</span> address</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A worker is now connected to &quot;</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>address <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong> 4.4、PM2</strong></p> <p>  PM2模块是cluster模块的一个包装层。它的作用是尽量将cluster模块抽象掉，让用户像使用单进程一样，部署多进程Node应用。</p> <p><strong> 4.5、nodemon</strong>
  是一个node自动重启工具。通过<code>nodemon app.js</code>来启动程序。程序改变后，不用重启程序，直接刷新浏览器就可以看到更新的内容。</p> <h3 id="_5、event"><a href="#_5、event" class="header-anchor">#</a> <strong>5、Event</strong></h3> <p>  Node 提供 Event Emitter 接口。通过事件，解决多状态异步操作的响应问题。events模块的EventEmitter是一个构造函数，可以用来生成事件发生器的实例emitter。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>EventEmitter<span class="token punctuation">;</span>
    <span class="token keyword">var</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//然后，事件发生器的实例方法on用来监听事件，实例方法emit用来发出事件。EventEmitter对象的事件触发和监听是同步的，即只有事件的回调函数执行以后，函数f才会继续执行。</span>
    emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'someEvent'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'event has occured'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'someEvent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// start</span>
    <span class="token comment">// event has occured</span>
    <span class="token comment">// end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>1、Event Emitter 接口的部署</strong></p> <p>  Event Emitter 接口可以部署在任意对象上，使得这些对象也能订阅和发布消息。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>EventEmitter<span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">Dog</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Dog</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
    <span class="token comment">// 另一种写法</span>
    <span class="token comment">// Dog.prototype = Object.create(EventEmitter.prototype);</span>
    <span class="token keyword">var</span> simon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">'simon'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    simon<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'bark'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">' barked'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    simon<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'bark'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//使ratio继承EventEmitter</span>
    util<span class="token punctuation">.</span><span class="token function">inherits</span><span class="token punctuation">(</span>Radio<span class="token punctuation">,</span> EventEmitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong> 2、Event Emitter 的实例方法</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token operator">:</span>对事件name指定监听函数f。

    emitter<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token operator">:</span>addListener是on方法的别名。
    emitter<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token operator">:</span>与on方法类似，但是监听函数f是一次性的，使用后自动移除。
    emitter<span class="token punctuation">.</span><span class="token function">listeners</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token operator">:</span>返回一个数组，成员是事件name所有监听函数
    emitter<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token operator">:</span>移除事件name的监听函数f
    emitter<span class="token punctuation">.</span><span class="token function">removeAllListeners</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token operator">:</span>移除事件name的所有监听函数
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>2.1、emit()</li></ul> <p>  EventEmitter实例对象的emit方法，用来触发事件。它的第一个参数是事件名称，其余参数都会依次传入回调函数。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>EventEmitter<span class="token punctuation">;</span>
    <span class="token keyword">var</span> myEmitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">connection</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'client id: '</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    myEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    myEmitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// client id: 6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>2.2、once()</li></ul> <p>  该方法类似于on方法，但是回调函数只触发一次。该方法返回一个EventEmitter对象，因此可以链式加载监听函数。</p> <ul><li>2.3、removeListener()</li></ul> <p>  该方法用于移除回调函数。它接受两个参数，第一个是事件名称，第二个是回调函数名称。这就是说，不能用于移除匿名函数。</p> <ul><li>2.4、setMaxListeners()</li></ul> <p>  Node默认允许同一个事件最多可以指定10个回调函数。</p> <ul><li>2.5、removeAllListeners()</li></ul> <p>  该方法用于移除某个事件的所有回调函数。</p> <ul><li>2.6、listeners()</li></ul> <p>  listeners方法接受一个事件名称作为参数，返回该事件所有回调函数组成的数组。</p> <ul><li>2.7、事件捕获</li></ul> <p>  事件处理过程中抛出的错误，可以使用try...catch捕获。监听函数抛出的错误被try...catch代码块捕获了。一旦被捕获，该事件后面的监听函数都不会再执行了。
  如果不使用try...catch，可以让进程监听uncaughtException事件。</p> <ul><li>2.8、默认事件</li></ul> <p>  Events模块默认支持两个事件。
newListener事件：添加新的回调函数时触发。
removeListener事件：移除回调时触发。</p> <h3 id="_6、express"><a href="#_6、express" class="header-anchor">#</a> <strong>6、express</strong></h3> <p>  Express是目前最流行的基于Node.js的Web开发框架，可以快速地搭建一个完整功能的网站。</p> <p><strong> 1、运行原理</strong></p> <ul><li><strong>1.1、底层:http模块</strong></li></ul> <p>  Express框架建立在node.js内置的http模块上。http模块生成服务器的原始代码如下。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Express框架的核心是对http模块的再包装。Express框架等于在http模块之上，加了一个中间层。</span>
    <span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>1.2、中间件</li></ul> <p>  中间件（middleware）就是处理HTTP请求的函数。它最大的特点就是，一个中间件处理完，再传递给下一个中间件。
  每个中间件可以接收三个参数，依次为request对象（代表HTTP请求）、response对象（代表HTTP回应），next回调函数（代表下一个中间件）。每个中间件都可以对HTTP请求（request对象）进行加工，并且决定是否调用next方法，将request对象再传给下一个中间件。中间件可以分为:</p> <ul><li>1)应用中间件</li> <li>2)路由中间件</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    使用步骤：
    <span class="token number">1</span>、获取路由中间件对象 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">let router=express.Router()</span><span class="token template-punctuation string">`</span></span>。
    <span class="token number">2</span>、配置路由规则  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">router.请求方式(url,(req,res,next)=&gt;{})</span><span class="token template-punctuation string">`</span></span>。
    <span class="token number">3</span>、将router加入到应用 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">app.use(router)</span><span class="token template-punctuation string">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>3)内置中间件</li> <li>4)第三方中间件</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">const</span> body<span class="token operator">-</span>parser<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot; body-parser&quot;</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>body<span class="token operator">-</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>5)错误处理中间件</li></ul> <p>  一个不进行任何操作、只传递request对象的中间件，就是下面这样。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">function</span> <span class="token function">uselessMiddleware</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>1.3、use()</li></ul> <p><code>use是express注册中间件的方法，它返回一个函数</code>。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;In comes a &quot;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>method <span class="token operator">+</span> <span class="token string">&quot; to &quot;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/plain&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//上面代码使用app.use方法，注册了两个中间件。收到HTTP请求后，先调用第一个中间件，在控制台输出一行信息，然后通过next方法，将执行权传给第二个中间件，输出HTTP回应。由于第二个中间件没有调用next方法，所以request对象就不再向后传递了。</span>

    <span class="token number">1</span><span class="token punctuation">)</span>use方法内部可以对访问路径进行判断，据此就能实现简单的路由，根据不同的请求网址，返回不同的网页内容。

    <span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>url <span class="token operator">==</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/plain&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome to the homepage!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token number">2</span><span class="token punctuation">)</span>use方法也允许将请求网址写在第一个参数。这代表，只有请求路径匹配这个参数，后面的中间件才会生效。
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/path'</span><span class="token punctuation">,</span> someMiddleware<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><strong> 2、Express的方法</strong></p> <ul><li>2.1、all方法和HTTP动词方法</li></ul> <p>  针对不同的请求，Express提供了use方法的一些别名。比如，上面代码也可以用别名的形式来写。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//所有请求都必须通过该中间件，参数中的“*”表示对所有路径有效。主要是拦截404</span>
    app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/plain&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//除了get方法以外，Express还提供post、put、delete方法，即HTTP动词都是Express的方法。</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome to the homepage!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/about&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome to the about page!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;404!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//这些方法的第一个参数，都是请求的路径。除了绝对匹配以外，Express允许模式匹配。</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/hello/:who&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, &quot;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>who <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//res.end()只能响应string||读文件中的data Buffer</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 匹配/commits/71dbb9c</span>
    <span class="token comment">// 或/commits/71dbb9c..4c084f9这样的git格式的网址</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/commits\/(\w+)(?:\.\.(\w+))?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> from <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> to <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'HEAD'</span><span class="token punctuation">;</span>
        <span class="token comment">//默认是utf-8</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'commit range '</span> <span class="token operator">+</span> from <span class="token operator">+</span> <span class="token string">'..'</span> <span class="token operator">+</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ul><li>2.2、set()</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>   <span class="token keyword">set</span>方法用于指定变量的值。
   app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;views&quot;</span><span class="token punctuation">,</span> __dirname <span class="token operator">+</span> <span class="token string">&quot;/views&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;view engine&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jade&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//使用get()方法获取</span>
   app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;views&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p>2.3、response对象<br></p> <p>1）Response.Redirect方法<br>
Response.Redirect的方法允许网址的重定向。<br></p> <p>2)response.sendFile方法<br>
response.sendFile方法用于发送文件。<br></p> <p>3)response.render方法<br>
response.render方法用于渲染网页模板。</p> <p>4)response.end方法<br>
response.end方法用于将数据返回给客户端。</p> <p>5)response.json<br>
response.json方法用于将接送数据返回给客户端。</p> <p>6)response.jsonp<br>
response.jsonp方法用于跨域。</p> <p>7)response.download<br>
response.download方法用于将下载。</p> <p>8)response.setHeader(&quot;a&quot;,&quot;234&quot;);<br>
用于写头。</p> <p>9)response.write(&quot;a&quot;,&quot;234&quot;);<br>
response.write方法用于将数据返回给客户端。</p></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>   
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Hello World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>2.4、request对象<br>
1）request.ip:
request.ip属性用于获得HTTP请求的IP地址。<br>
2）request.files:
request.files用于获取上传的文件。</li></ul> <p><strong> 3、配置路由</strong></p> <p>  所谓“路由”，就是指为不同的访问路径，指定不同的处理方法。</p> <ul><li>3.1、指定根路径</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//send方法，表示向浏览器发送一个字符串</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//回调函数的req参数表示客户端发来的HTTP请求，res参数代表发向客户端的HTTP回应，这两个参数都是对象。</span>
    <span class="token comment">//如果需要指定HTTP头信息，回调函数就必须换一种写法，要使用setHeader方法与end方法。</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token string">'Hello World'</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Length'</span><span class="token punctuation">,</span> body<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>3.2、指定特定路径</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//res.json(200, {name:&quot;张三&quot;,age:40});</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>3.3、静态网页模板</li></ul> <p>  sendfile()专门用于发送文件。
在项目目录之中，建立一个子目录views，用于存放网页模板。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/views/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/views/about.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/article'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/views/article.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>3.4、动态网页模板</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">//安装模板引擎</span>
    npm install hbs <span class="token operator">--</span>save<span class="token operator">-</span>dev
    <span class="token comment">//使用模板引擎</span>
    <span class="token comment">//render方法的参数就是模板的文件名，默认放在子目录views之中，后缀名已经在前面指定为html，</span>
    app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">,</span> hbs<span class="token punctuation">.</span>__express<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//中间件</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">&quot;最近文章&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">entries</span><span class="token operator">:</span>blogEngine<span class="token punctuation">.</span><span class="token function">getBlogEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'about'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">&quot;自我介绍&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/article/:id'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> entry <span class="token operator">=</span> blogEngine<span class="token punctuation">.</span><span class="token function">getBlogEntry</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'article'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span>entry<span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token literal-property property">blog</span><span class="token operator">:</span>entry<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li>3.5、指定静态文件目录</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//使用public指代public目录下的文件</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong> 4、Express.Router用法</strong></p> <ul><li>4.1、基本用法</li></ul> <p>  Express.Router是一个构造函数，调用后返回一个路由器实例。然后，使用该实例的HTTP动词方法，为不同的访问路径，指定回调函数；最后，挂载到某个路径。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//为不同的路径，指定回调函数</span>
    router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'首页'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'关于'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将路由挂载到某个路径</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/app'</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>4.2、router.route方法</li></ul> <p>  router实例对象的route方法，可以接受访问路径作为参数。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Bear<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> bears</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>bears<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>4.3、router中间件</li></ul> <p>  use方法为router对象指定中间件，即在数据正式发给用户之前，对数据进行处理。下面就是一个中间件的例子。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token punctuation">,</span> req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//函数体中的next()，表示将数据传递给下一个中间件。</span>
    <span class="token comment">//注意，中间件的放置顺序很重要，等同于执行顺序。而且，中间件必须放在HTTP动词方法之前，否则不会执行。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>4.4、对路径参数的处理</li></ul> <p>  router对象的param方法用于路径参数的处理</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    router<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 对name进行验证或其他处理……</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/hello/:name'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello '</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    注意，param方法必须放在<span class="token constant">HTTP</span>动词方法之前。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>4.5、app.route</li></ul> <p>  app.route实际上是express.Router()的缩写形式，除了直接挂载到根路径。因此，对同一个路径指定get和post方法的回调函数，可以写成链式形式。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    app<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'this is the login form'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'processing'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'processing the login form!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_9、os模块"><a href="#_9、os模块" class="header-anchor">#</a> <strong>9、os模块</strong></h3> <p>  os模块提供与操作系统相关的方法。</p> <p><strong> 9.1、os.EOL</strong></p> <p>  该属性是一个常量，返回当前操作系统的换行符（Windows系统是\r\n，其他系统是\n）</p> <p><strong> 9.2、os.arch()</strong></p> <p>  os.arch方法返回当前计算机的架构。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">os</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// &quot;x64&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong> 9.3、os.tmpdir()</strong></p> <p>  os.tmpdir方法返回操作系统默认的临时文件目录。</p> <h3 id="_10、process对象"><a href="#_10、process对象" class="header-anchor">#</a> <strong>10、process对象</strong></h3> <p>  process对象是 Node 的一个全局对象，提供当前 Node 进程的信息。它可以在脚本的任意位置使用，不必通过require命令加载。该对象部署了EventEmitter接口。</p> <p><strong> 10.1、属性</strong></p> <ul><li>1、process.argv：返回一个数组，成员是当前进程的所有命令行参数。</li> <li>2、process.env：返回一个对象，成员为当前Shell的环境变量，比如process.env.HOME。</li> <li>3、process.installPrefix：返回一个字符串，表示 Node 安装路径的前缀，比如/usr/local。相应地，Node 的执行文件目录为/usr/local/bin/node。</li> <li>4、process.pid：返回一个数字，表示当前进程的进程号。</li> <li>5、process.platform：返回一个字符串，表示当前的操作系统，比如Linux。</li> <li>6、process.title：返回一个字符串，默认值为node，可以自定义该值。</li> <li>7、process.version：返回一个字符串，表示当前使用的 Node 版本，比如v7.10.0。</li></ul> <p><strong> 10.2、process对象还有一些属性，用来指向 Shell 提供的接口</strong>。</p> <ul><li><strong>1、process.stdout</strong></li></ul> <p>  返回一个对象，表示标准输出。该对象的write方法等同于console.log，可用在标准输出向用户显示内容。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    console<span class="token punctuation">.</span><span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>d <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><strong>2、process.stdin</strong></li></ul> <p>  返回一个对象，表示标准输入。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token comment">//将标准输入导向标准输出。</span>
    <span class="token comment">//stdin和stdout都部署了stream接口，所以可以使用stream接口的方法。</span>
    process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> chunk <span class="token operator">=</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>chunk <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'data: '</span> <span class="token operator">+</span> chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><strong>3、stderr</strong></li></ul> <p>  process.stderr属性指向标准错误。</p> <ul><li><strong>4、process.argv，process.execPath，process.execArgv</strong></li> <li>1）process.argv属性返回一个数组，由命令行执行脚本时的各个参数组成。它的第一个成员总是node，第二个成员是脚本文件名，其余成员是脚本文件的参数。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">//node.js</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;argv: &quot;</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> myArgs <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//在git bash中运行</span>
    $ node argv<span class="token punctuation">.</span>js a b c
    <span class="token punctuation">[</span> <span class="token string">'node'</span><span class="token punctuation">,</span> <span class="token string">'/path/to/argv.js'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span> <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><p>2）process.execPath属性返回执行当前脚本的Node二进制文件的绝对路径。</p></li> <li><p>3）process.execArgv属性返回一个数组，成员是命令行下执行脚本时，在 Node 可执行文件与脚本文件之间的命令行参数。</p></li> <li><p><strong>5、process.env</strong></p></li></ul> <p>  process.env属性返回一个对象，包含了当前Shell的所有环境变量。比如，process.env.HOME返回用户的主目录。
  通常的做法是，新建一个环境变量NODE_ENV，用它确定当前所处的开发阶段，生产阶段设为production，开发阶段设为develop或staging，然后在脚本中读取process.env.NODE_ENV即可。
  运行脚本时，改变环境变量，可以采用下面的写法。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    $ <span class="token keyword">export</span> <span class="token constant">NODE_ENV</span><span class="token operator">=</span>production <span class="token operator">&amp;&amp;</span> node app<span class="token punctuation">.</span>js
    # 或者
    $ <span class="token constant">NODE_ENV</span><span class="token operator">=</span>production node app<span class="token punctuation">.</span>js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong> 10.3、方法</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    process<span class="token punctuation">.</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：切换工作目录到指定目录。
    process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：返回运行当前脚本的工作目录的路径（绝对路径）。
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：立刻退出当前进程。
    process<span class="token punctuation">.</span><span class="token function">getgid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：返回当前进程的组<span class="token constant">ID</span>（数值）。
    process<span class="token punctuation">.</span><span class="token function">getuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：返回当前进程的用户<span class="token constant">ID</span>（数值）。
    process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：指定回调函数在当前执行栈的尾部、下一次Event Loop之前执行。
    process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：监听事件。
    process<span class="token punctuation">.</span><span class="token function">setgid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：指定当前进程的组，可以使用数字<span class="token constant">ID</span>，也可以使用字符串<span class="token constant">ID</span>。
    process<span class="token punctuation">.</span><span class="token function">setuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：指定当前进程的用户，可以使用数字<span class="token constant">ID</span>，也可以使用字符串<span class="token constant">ID</span>。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li><strong>1、process.cwd()与__dirname的区别。</strong></li></ul> <p>  前者进程发起时的位置，后者是脚本的位置，两者可能是不一致的。比如，node ./code/program.js，对于process.cwd()来说，返回的是当前目录（.）；对于__dirname来说，返回是脚本所在目录，即./code/program.js。</p> <ul><li><strong>2、process.nextTick()</strong></li></ul> <p>  process.nextTick将任务放到当前一轮事件循环（Event Loop）的尾部。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'下一次Event Loop即将开始!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//上面代码可以用setTimeout(f,0)改写，效果接近，但是原理不同。</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>是将任务放到下一轮事件循环的头部，因此nextTick会比它先执行。另外，nextTick的效率更高，因为不用检查是否到了指定时间。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><strong>3、process.exit()</strong></li></ul> <p>  process.exit方法用来退出当前进程。它可以接受一个数值参数，如果参数大于0，表示执行失败；如果等于0表示执行成功。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//如果不带有参数，exit方法的参数默认为0。</span>
    更安全的方法是使用exitcode属性，指定退出状态，然后再抛出一个错误。
    process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;xx condition failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li><strong>4、process.on()</strong></li></ul> <p>  process对象部署了EventEmitter接口，可以使用on方法监听各种事件，并指定回调函数。</p> <p>  process支持的事件还有下面这些。</p> <ul><li><p>1）uncaughtException：当前进程抛出一个没有被捕捉的错误时，会触发uncaughtException事件。。</p></li> <li><p>2）data事件：数据输出输入时触发</p></li> <li><p>3）SIGINT事件：接收到系统信号SIGINT时触发，主要是用户按Ctrl + c时触发。</p></li> <li><p>4）SIGTERM事件：系统发出进程终止信号SIGTERM时触发</p></li> <li><p>5）exit事件：进程退出前触发</p></li> <li><p><strong>5、process.kill()</strong></p></li></ul> <p>  process.kill方法用来对指定ID的线程发送信号，默认为SIGINT信号。</p> <p>  process.kill(process.pid, 'SIGTERM');
上面代码用于杀死当前进程。</p> <ul><li><strong>6、beforeExit事件</strong></li></ul> <p>  beforeExit事件在Node清空了Event Loop以后，再没有任何待处理的任务时触发。正常情况下，如果没有任何待处理的任务，Node进程会自动退出，设置beforeExit事件的监听函数以后，就可以提供一个机会，再部署一些任务，使得Node进程不退出。<br>
  beforeExit事件与exit事件的主要区别是，beforeExit的监听函数可以部署异步任务，而exit不行。</p> <ul><li><strong>7、信号事件</strong></li></ul> <p>  主要对SIGTERM和SIGINT信号部署监听函数，这两个信号在非Windows平台会导致进程退出，但是只要部署了监听函数，Node进程收到信号后就不会退出。</p> <ul><li><strong>8、进程的退出码</strong></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token number">0</span>，正常退出
    <span class="token number">1</span>，发生未捕获错误
    <span class="token number">5</span>，<span class="token constant">V8</span>执行错误
    <span class="token number">8</span>，不正确的参数
    <span class="token number">128</span> <span class="token operator">+</span> 信号值，如果Node接受到退出信号（比如<span class="token constant">SIGKILL</span>或<span class="token constant">SIGHUP</span>），它的退出码就是<span class="token number">128</span>加上信号值。由于<span class="token number">128</span>的二进制形式是<span class="token number">10000000</span><span class="token punctuation">,</span> 所以退出码的后七位就是信号值。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_11、url"><a href="#_11、url" class="header-anchor">#</a> <strong>11、url</strong></h3> <p>  url模块用于生成和解析URL。该模块使用前，必须加载。</p> <p><strong> 11.1、url.resolve(from, to)</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    url<span class="token punctuation">.</span>resolve方法用于生成<span class="token constant">URL</span>。它的第一个参数是基准<span class="token constant">URL</span>，其余参数依次根据基准<span class="token constant">URL</span>，生成对应的位置。
    url<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'/one/two/three'</span><span class="token punctuation">,</span> <span class="token string">'four'</span><span class="token punctuation">)</span>
    <span class="token comment">// '/one/two/four'</span>
    url<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">,</span> <span class="token string">'/one'</span><span class="token punctuation">)</span>
    <span class="token comment">// 'http://example.com/one'</span>

    url<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'http://example.com/one/'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">)</span>
    <span class="token comment">// 'http://example.com/one/two'</span>

    url<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'http://example.com/one'</span><span class="token punctuation">,</span> <span class="token string">'/two'</span><span class="token punctuation">)</span>
    <span class="token comment">// 'http://example.com/two'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_12、querystring"><a href="#_12、querystring" class="header-anchor">#</a> <strong>12、querystring</strong></h3> <p>  querystring模块主要用来解析查询字符串。</p> <p><strong> 1、querystring.parse()</strong></p> <p>  用于将一个查询字符串解析为 JavaScript 对象。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    parse方法一共可以接受四个参数。
    str：需要解析的查询字符串
    sep：多个键值对之间的分隔符，默认为<span class="token operator">&amp;</span>
    eq：键名与键值之间的分隔符，默认为<span class="token operator">=</span>
    options：配置对象，它有两个属性，decodeURIComponent属性是一个函数，用来将编码后的字符串还原，默认是querystring<span class="token punctuation">.</span><span class="token function">unescape</span><span class="token punctuation">(</span><span class="token punctuation">)</span>，maxKeys属性指定最多解析多少个属性，默认是<span class="token number">1000</span>，如果设为<span class="token number">0</span>就表示不限制属性的最大数量。
parse方法也可以用来解析一般的字符串。
    <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'name:Sophie;shape:fox;condition:new'</span><span class="token punctuation">;</span>
    querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">';'</span><span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">)</span>
    <span class="token comment">// {</span>
    <span class="token comment">//   name: 'Sophie',</span>
    <span class="token comment">//   shape: 'fox',</span>
    <span class="token comment">//   condition: 'new',</span>
    <span class="token comment">// }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_13、stream"><a href="#_13、stream" class="header-anchor">#</a> <strong>13、stream</strong></h3> <p><strong> 1、概念</strong></p> <p>  &quot;数据流&quot;（stream）是处理系统缓存的一种方式。操作系统采用数据块（chunk）的方式读取数据，每收到一次数据，就存入缓存。Node应用程序有两种缓存的处理方式，第一种是等到所有数据接收完毕，一次性从缓存读取，这就是传统的读取文件的方式；第二种是采用&quot;数据流&quot;的方式，收到一块数据，就读取一块，即在数据还没有接收完成时，就开始处理它。<br>
  第一种方式先将数据全部读入内存，然后处理，优点是符合直觉，流程非常自然，缺点是如果遇到大文件，要花很长时间，才能进入数据处理的步骤。第二种方式每次只读入数据的一小块，像&quot;流水&quot;一样，每当系统读入了一小块数据，就会触发一个事件，发出&quot;新数据块&quot;的信号。应用程序只要监听这个事件，就能掌握数据读取的进展，做出相应处理，这样就提高了程序的性能。</p> <p><strong>数据流接口最大特点就是通过事件通信</strong>，具有readable、writable、drain、data、end、close等事件，既可以读取数据，也可以写入数据。读写数据时，每读入（或写入）一段数据，就会触发一次data事件，全部读取（或写入）完毕，触发end事件。如果发生错误，则触发error事件。</p> <p><strong> 2、可读数据流</strong></p> <p>  &quot;可读数据流&quot;用来产生数据。它表示数据的来源，只要一个对象提供&quot;可读数据流&quot;，就表示你可以从其中读取数据。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> Readable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Readable<span class="token punctuation">;</span>
    <span class="token keyword">var</span> rs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Readable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'beep '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'boop\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//rs.push(null)中的null，用来告诉rs，数据输入完毕。</span>
    rs<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>  &quot;可读数据流&quot;有两种状态：<strong>流动态和暂停态</strong>。处于流动态时，数据会尽快地从数据源导向用户的程序；处于暂停态时，必须显式调用stream.read()等指令，&quot;可读数据流&quot;才会释放数据。刚刚新建的时候，&quot;可读数据流&quot;处于暂停态。</p> <p>  三种方法可以让暂停态转为流动态。</p> <ul><li>1、添加data事件的监听函数</li> <li>2、调用resume方法</li> <li>3、调用pipe方法将数据送往一个可写数据流。</li></ul> <p>  如果转为流动态时，没有data事件的监听函数，也没有pipe方法的目的地，那么数据将遗失。</p> <p>  以下两种方法可以让流动态转为暂停态。</p> <ul><li>1、不存在pipe方法的目的地时，调用pause方法</li> <li>2、存在pipe方法的目的地时，移除所有data事件的监听函数，并且调用unpipe方法，移除所有pipe方法的目的地。</li></ul> <p>  注意，只移除data事件的监听函数，并不会自动引发数据流进入&quot;暂停态&quot;。另外，存在pipe方法的目的地时，调用pause方法，并不能保证数据流总是处于暂停态，一旦那些目的地发出数据请求，数据流有可能会继续提供数据。每当系统有新的数据，该接口可以监听到data事件，从而回调函数。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> readableStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

    readableStream<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    readableStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token operator">+=</span>chunk<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    readableStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>  监听readable事件，也可以读到数据。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> readableStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> chunk<span class="token punctuation">;</span>
    readableStream<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readableStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>chunk<span class="token operator">=</span>readableStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    readableStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>  readable事件表示系统缓冲之中有可读的数据，使用read方法去读出数据。如果没有数据可读，read方法会返回null。
  &quot;可读数据流&quot;除了read方法，还有以下方法。</p> <ul><li><p>1、Readable.pause() ：暂停数据流。已经存在的数据，也不再触发data事件，数据将保留在缓存之中，此时的数据流称为静态数据流。如果对静态数据流再次调用pause方法，数据流将重新开始流动，但是缓存中现有的数据，不会再触发data事件。</p></li> <li><p>2、Readable.resume()：恢复暂停的数据流。</p></li> <li><p>3、readable.unpipe()：从管道中移除目的地数据流。如果该方法使用时带有参数，会阻止“可读数据流”进入某个特定的目的地数据流。如果使用时不带有参数，则会移除所有的目的地数据流。</p></li> <li><p><strong>2、1 readable 属性</strong></p></li></ul> <p>  一个数据流的readable属性返回一个布尔值。如果数据流是一个仍然打开的可读数据流，就返回true，否则返回false。</p> <ul><li><strong>2、2 read()</strong></li></ul> <p>  read方法从系统缓存读取并返回数据。如果读不到数据，则返回null。该方法可以接受一个整数作为参数，表示所要读取数据的数量，然后会返回该数量的数据。如果读不到足够数量的数据，返回null。如果不提供这个参数，默认返回系统缓存之中的所有数据。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> readable <span class="token operator">=</span> <span class="token function">getReadableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readable<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> chunk<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!==</span> <span class="token punctuation">(</span>chunk <span class="token operator">=</span> readable<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'got %d bytes of data'</span><span class="token punctuation">,</span> chunk<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//如果该方法返回一个数据块，那么它就触发了data事件。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><strong>2、3 _read()</strong></li></ul> <p>  可读数据流的_read方法，可以将数据放入可读数据流。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> Readable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Readable<span class="token punctuation">;</span>
    <span class="token keyword">var</span> rs <span class="token operator">=</span> <span class="token function">Readable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">97</span><span class="token punctuation">;</span>
    rs<span class="token punctuation">.</span><span class="token function-variable function">_read</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>c<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&gt;</span> <span class="token string">'z'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
        rs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    rs<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li><strong>2、4 setEncoding()</strong></li></ul> <p>  调用该方法，会使得数据流返回指定编码的字符串，而不是缓存之中的二进制对象。比如，调用setEncoding('utf8')，数据流会返回UTF-8字符串。</p> <ul><li><strong>2、5 resume()</strong></li></ul> <p>  resume方法会使得“可读数据流”继续释放data事件，即转为流动态。</p> <ul><li><strong>2、6 pause()</strong></li></ul> <p>  pause方法使得流动态的数据流，停止释放data事件，转而进入暂停态。任何此时已经可以读到的数据，都将停留在系统缓存。</p> <ul><li><strong>2、7 isPaused()</strong></li></ul> <p>  该方法返回一个布尔值，表示&quot;可读数据流&quot;被客户端手动暂停（即调用了pause方法），目前还没有调用resume方法。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> Readable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Readable<span class="token punctuation">;</span>
    <span class="token keyword">var</span> readable <span class="token operator">=</span> <span class="token function">Readable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    readable<span class="token punctuation">.</span><span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// === false</span>
    readable<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    readable<span class="token punctuation">.</span><span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// === true</span>
    readable<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    readable<span class="token punctuation">.</span><span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// === false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><strong>2、8 pipe()</strong></li></ul> <p>  pipe方法是自动传送数据的机制，就像管道一样。它从&quot;可读数据流&quot;读出所有数据，将其写出到指定的目的地。整个过程是自动的。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    src<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>dst<span class="token punctuation">)</span>
    <span class="token comment">//pipe方法必须在可读数据流上调用，它的参数必须是可写数据流。</span>
    <span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> readableStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'node.md'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> writableStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'file2.doc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readableStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writableStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//pipe方法返回目的地的数据流，因此可以使用链式写法，将多个数据流操作连在一起。</span>
    a<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
    <span class="token comment">// 等同于</span>
    a<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    b<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    c<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//当来源地的数据流读取完成，默认会调用目的地的end方法，就不再能够写入。对pipe方法传入第二个参数{ end: false }，可以让目的地的数据流保持打开。</span>
    reader<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Goodbye\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//上面代码中，目的地数据流默认不会调用end方法，只能手动调用，因此“Goodbye”会被写入。</span>
    <span class="token comment">//test.js</span>
    process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    node test<span class="token punctuation">.</span>js <span class="token comment">//將在cmd中輸入什麼，就將輸出什麼</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ul><li><strong>2、9 unpipe()</strong></li></ul> <p>  该方法移除pipe方法指定的数据流目的地。如果没有参数，则移除所有的pipe方法目的地。如果有参数，则移除该参数指定的目的地。如果没有匹配参数的目的地，则不会产生任何效果。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> readable <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> writable <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'file1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readable<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'停止写入file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        readable<span class="token punctuation">.</span><span class="token function">unpipe</span><span class="token punctuation">(</span>writable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'手动关闭file.txt的写入数据流'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writable<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li><strong>2、10 事件</strong></li> <li>1)readable事件</li></ul> <p>   readable事件在数据流能够向外提供数据时触发。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> readable <span class="token operator">=</span> <span class="token function">getReadableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readable<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// there is some data to read now</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将标准输入的数据读出。</span>
    process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> buf <span class="token operator">=</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>2)data事件</li></ul> <p>  对于那些没有显式暂停的数据流，添加data事件监听函数，会将数据流切换到流动态，尽快向外提供数据。</p> <ul><li>3)end事件</li></ul> <p>  无法再读取到数据时，会触发end事件。也就是说，只有当前数据被完全读取完，才会触发end事件，比如不停地调用read方法。</p> <ul><li>4)close</li></ul> <p>  数据源关闭时，close事件被触发。并不是所有的数据流都支持这个事件。</p> <ul><li>5)error</li></ul> <p>  当读取数据发生错误时，error事件被触发。</p> <p><strong> 3、继承可读数据流接口</strong></p> <p>  可读数据流又分成两种，一种是 pull 模式，自己拉数据，就好像用吸管吸水，只有你吸了，水才会上来；另一种是 push 模式，数据自动推送给你，就好像水从水龙头自动涌出来。如果监听data事件，那么自动激活 push 模式；如果自己从数据流读取数据，那就是在使用 pull 模式。<br>
  注意，<strong>数据流新建以后，默认状态是暂停，只有指定了data事件的回调函数，或者调用了resume方法，数据才会开发发送。</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> stream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'readme.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stream<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    stream<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//显式调用pause方法，会使得readable事件释放一个data事件，否则data监听无效</span>
    <span class="token keyword">var</span> pulledData <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> pushedData <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'readable'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> chunk<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>chunk <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pulledData <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pushedData <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong> 4、可写数据流</strong></p> <p>  &quot;可读数据流&quot;用来对外释放数据，&quot;可写数据流&quot;则是用来接收数据。它允许你将数据写入某个目的地。它是数据写入的一种抽象，不同的数据目的地部署了这个接口以后，就可以用统一的方法写入。</p> <p>  以下是部署了可写数据流的一些场合。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token number">1</span>、客户端的http requests
    <span class="token number">2</span>、服务器的http responses
    <span class="token number">3</span>、fs write streams
    <span class="token number">4</span>、zlib streams
    <span class="token number">5</span>、crypto streams
    <span class="token number">6</span>、tcp sockets
    <span class="token number">7</span>、child process stdin
    <span class="token number">8</span>、process<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> process<span class="token punctuation">.</span>stderr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>  部署&quot;可写数据流&quot;，必须继承stream.Writable，以及实现stream._write方法。下面是一个例子，数据库的写入接口部署“可写数据流”接口。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> Writable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Writable<span class="token punctuation">;</span>
    <span class="token keyword">var</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> DatabaseWriteStream<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">DatabaseWriteStream</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">DatabaseWriteStream</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseWriteStream</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> options<span class="token punctuation">)</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            options<span class="token punctuation">.</span>objectMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">Writable</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//继承</span>
    util<span class="token punctuation">.</span><span class="token function">inherits</span><span class="token punctuation">(</span>DatabaseWriteStream<span class="token punctuation">,</span> Writable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">DatabaseWriteStream</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_write</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token parameter">doc<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">insertIntoDatabase</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>  下面是fs模块的可写数据流的例子。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> readableStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'file1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> writableStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'file2.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readableStream<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readableStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        writableStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><strong>4.1、 writable属性</strong></li></ul> <p>  writable属性返回一个布尔值。如果数据流仍然打开，并且可写，就返回true，否则返回false。</p> <ul><li><strong>4.2、 write()</strong></li></ul> <p>  write方法用于向&quot;可写数据流&quot;写入数据。它接受两个参数，一个是写入的内容，可以是字符串，也可以是一个stream对象（比如可读数据流）或buffer对象（表示二进制数据），另一个是写入完成后的回调函数，它是可选的。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    s<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 写入二进制数据</span>
    s<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> encoding<span class="token punctuation">)</span> <span class="token comment">// 写入字符串，编码默认为utf-8  </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>  write方法返回一个布尔值，表示本次数据是否处理完成。如果返回true，就表示可以写入新的数据了。如果等待写入的数据被缓存了，就返回false，表示此时不能立刻写入新的数据。不过，返回false的情况下，也可以继续传入新的数据等待写入。只是这时，新的数据不会真的写入，只会缓存在内存中。为了避免内存消耗，比较好的做法还是等待该方法返回true，然后再写入。</p> <ul><li><strong>4.3、 cork()，uncork()</strong></li></ul> <p>  cork方法可以强制等待写入的数据进入缓存。当调用uncork方法或end方法时，缓存的数据就会吐出。</p> <ul><li><strong>4.4、 setDefaultEncoding()</strong></li></ul> <p>  setDefaultEncoding方法用于将写入的数据编码成新的格式。它返回一个布尔值，表示编码是否成功，如果返回false就表示编码失败。</p> <ul><li><strong>4.5、end()</strong></li></ul> <p>  end方法用于终止&quot;可写数据流&quot;。该方法可以接受三个参数，全部都是可选参数。第一个参数是最后所要写入的数据，可以是字符串，也可以是stream对象或buffer对象；第二个参数是写入编码；第三个参数是一个回调函数，finish事件发生时，会触发这个回调函数。
调用end方法之后，再写入数据会报错。</p> <ul><li><strong>4.6、事件</strong></li> <li>1）drain事件</li></ul> <p>  writable.write(chunk)返回false以后，当缓存数据全部写入完成，可以继续写入时，会触发drain事件，表示缓存空了。</p> <ul><li>2） finish事件</li></ul> <p>  调用end方法时，所有缓存的数据释放，触发finish事件。该事件的回调函数没有参数。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> writer <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'example.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello, #'</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">'!\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'this is the end\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    writer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'all writes are now complete.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>3） pip事件</li></ul> <p>  &quot;可读数据流&quot;调用pipe方法，将可读数据流写入目的地时，触发该事件。该事件的回调函数，接受发出该事件的&quot;可读数据流&quot;对象作为参数。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> writer <span class="token operator">=</span> <span class="token function">getWritableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token function">getReadableStreamSomehow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    writer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'pipe'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'something is piping into the writer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>4)unpipe事件</li></ul> <p>  &quot;可读数据流&quot;调用unpipe方法，将可写数据流移出写入目的地时，触发该事件。
该事件的回调函数，接受发出该事件的&quot;可读数据流&quot;对象作为参数。</p> <ul><li>5)error事件</li></ul> <p>  如果写入数据或pipe数据时发生错误，就会触发该事件。该事件的回调函数，接受一个Error对象作为参数。</p> <ul><li><strong>4.7、错误处理</strong></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">var</span> onFinished <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'on-finished'</span><span class="token punctuation">)</span>
    http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// set the content headers</span>
        fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'filename.txt'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> onerror<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>zlib<span class="token punctuation">.</span><span class="token function">createGzip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> onerror<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

        <span class="token keyword">function</span> <span class="token function">onerror</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">onFinished</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// make sure the stream is always destroyed</span>
            stream<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_14、net模块和dns模块"><a href="#_14、net模块和dns模块" class="header-anchor">#</a> <strong>14、Net模块和DNS模块</strong></h3> <p>  net模块用于底层的网络通信。
下面是一段简单的监听2000端口的代码。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> server <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Listening on port 2000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Accepting connection from'</span><span class="token punctuation">,</span> stream<span class="token punctuation">.</span>remoteAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
            stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
                stream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Connection closed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong> 1、isIP()</strong></p> <p>  isIP方法用于判断某个字符串是否为IP地址。</p> <p><strong> 2、DNS模块用于解析域名</strong></p> <p>  resolve4方法用于IPv4环境，resolve6方法用于IPv6环境，lookup方法在以上两种环境都可以使用，返回IP地址（address）和当前环境（IPv4或IPv6）</p> <h3 id="_15、commonjs规范"><a href="#_15、commonjs规范" class="header-anchor">#</a> <strong>15、CommonJS规范</strong></h3> <p><strong> 1、概述</strong></p> <p>  Node 应用由模块组成，采用 CommonJS 模块规范。
<strong>每个文件就是一个模块，有自己的作用域。在一个文件里面定义的变量、函数、类，都是私有的，对其他文件不可见。</strong>
CommonJS规范规定，每个模块内部，<strong>module变量代表当前模块</strong>。这个变量是一个对象，它的exports属性（即module.exports）是对外的接口。加载某个模块，其实是加载该模块的module.exports属性。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">addX</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value <span class="token operator">+</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>addX <span class="token operator">=</span> addX<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language- extra-class"><pre><code>    CommonJS模块的特点如下。
        1、所有代码都运行在模块作用域，不会污染全局作用域。
        2、模块可以多次加载，但是只会在第一次加载时运行一次，然后运行结果就被缓存了，以后再加载，就直接读取缓存结果。要想让模块再次运行，必须清除缓存。
        3、模块加载的顺序，按照其在代码中出现的顺序。
</code></pre></div><p><strong> 2、module对象</strong></p> <p>  Node内部提供一个Module构建函数。所有模块都是Module的实例。每个模块内部，都有一个module对象，代表当前模块。它有以下属性。</p> <ul><li><p>1)module.id 模块的识别符，通常是带有绝对路径的模块文件名。</p></li> <li><p>2)module.filename 模块的文件名，带有绝对路径。</p></li> <li><p>3)module.loaded 返回一个布尔值，表示模块是否已经完成加载。</p></li> <li><p>4)module.parent 返回一个对象，表示调用该模块的模块。module.parent就是调用它的父模块。利用这一点，可以判断当前模块是否为入口脚本。</p></li> <li><p>5)module.children 返回一个数组，表示该模块要用到的其他模块。</p></li> <li><p>6)module.exports 表示模块对外输出的值。</p></li> <li><p><strong>2、1 module.exports属性</strong></p></li></ul> <p>  module.exports属性表示当前模块对外输出的接口，其他文件加载该模块，实际上就是读取module.exports变量。</p> <ul><li><strong>2、2 exports变量</strong></li></ul> <p>  Node为每个模块提供一个exports变量，指向module.exports。这等同在每个模块头部，有一行这样的命令。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">var</span> exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>  注意，<strong>不能直接将exports变量指向一个值，因为这样等于切断了exports与module.exports的联系。</strong>
如果一个模块的对外接口，就是一个单一的值，不能使用exports输出，只能使用module.exports输出。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong> 3、AMD规范与CommonJS规范的兼容性</strong></p> <p>  CommonJS规范加载模块是同步的，也就是说，只有加载完成，才能执行后面的操作。AMD规范则是非同步加载模块，允许指定回调函数。由于Node.js主要用于服务器编程，模块文件一般都已经存在于本地硬盘，所以加载起来比较快，不用考虑非同步加载的方式，所以CommonJS规范比较适用。但是，如果是浏览器环境，要从服务器端加载模块，这时就必须采用非同步模式，因此浏览器端一般采用AMD规范。</p> <h3 id="_16、npm包管理器"><a href="#_16、npm包管理器" class="header-anchor">#</a> <strong>16、npm包管理器</strong></h3> <p><strong> 1、npm安装模块时，对应的版本可以加上各种限定，主要有以下几种：</strong></p> <ul><li>1)指定版本：比如1.2.2，遵循“大版本.次要版本.小版本”的格式规定，安装时只安装指定版本。</li> <li>2)波浪号（tilde）+指定版本：比如~1.2.2，表示安装1.2.x的最新版本（不低于1.2.2），但是不安装1.3.x，也就是说安装时不改变大版本号和次要版本号。</li> <li>3)插入号（caret）+指定版本：比如ˆ1.2.2，表示安装1.x.x的最新版本（不低于1.2.2），但是不安装2.x.x，也就是说安装时不改变大版本号。需要注意的是，如果大版本号为0，则插入号的行为与波浪号相同，这是因为此时处于开发阶段，即使是次要版本号变动，也可能带来程序的不兼容。</li> <li>4)latest：安装最新版本。</li></ul> <p><strong> 2、npm安装：</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    $ npm install npm@latest <span class="token operator">-</span>g
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong> 3、npm init</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    npm init用来初始化生成一个新的<span class="token keyword">package</span><span class="token punctuation">.</span>json文件。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong> 4、npm set</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    npm <span class="token keyword">set</span>用来设置环境变量。
    $ npm <span class="token keyword">set</span> init<span class="token operator">-</span>author<span class="token operator">-</span>name <span class="token string">'Your name'</span>
    $ npm <span class="token keyword">set</span> init<span class="token operator">-</span>author<span class="token operator">-</span>email <span class="token string">'Your email'</span>
    $ npm <span class="token keyword">set</span> init<span class="token operator">-</span>author<span class="token operator">-</span>url <span class="token string">'http://yourdomain.com'</span>
    $ npm <span class="token keyword">set</span> init<span class="token operator">-</span>license <span class="token string">'MIT'</span>
    
    $ npm <span class="token keyword">set</span> save<span class="token operator">-</span>exact <span class="token boolean">true</span>
    上面命令设置加入模块时，<span class="token keyword">package</span><span class="token punctuation">.</span>json将记录模块的确切版本，而不是一个可选的版本范围。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong> 5、npm config</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    npm config <span class="token keyword">set</span> prefix $dir
    <span class="token comment">//上面的命令将指定的$dir目录，设为模块的全局安装目录。</span>
    npm config <span class="token keyword">set</span> save<span class="token operator">-</span>prefix <span class="token operator">~</span>
    <span class="token comment">//上面的命令使得npm install --save和npm install --save-dev安装新模块时，允许的版本范围从克拉符号（^）改成波浪号（~），即从允许小版本升级，变成只允许补丁包的升级。</span>
    $ npm config <span class="token keyword">set</span> init<span class="token punctuation">.</span>author<span class="token punctuation">.</span>name $name
    $ npm config <span class="token keyword">set</span> init<span class="token punctuation">.</span>author<span class="token punctuation">.</span>email $email
    <span class="token comment">//上面命令指定使用npm init时，生成的package.json文件的字段默认值。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong> 6、npm info</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">//npm info命令可以查看每个模块的具体信息。比如，查看underscore模块的信息。</span>
    npm info underscore
    <span class="token comment">//上面命令返回一个JavaScript对象，包含了underscore模块的详细信息。这个对象的每个成员，都可以直接从info命令查询。</span>
    npm info underscore description
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong> 7、npm search</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    npm search命令用于搜索npm仓库，它后面可以跟字符串，也可以跟正则表达式。
    npm search webpack
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong> 8、npm list</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    npm list命令以树型结构列出当前项目安装的所有模块，以及它们依赖的模块。
    加上global参数，会列出全局安装的模块。
    npm list <span class="token operator">-</span>global
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong> 9、npm install</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">//npm install也支持直接输入Github代码库地址。</span>
    $ npm install git<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token keyword">package</span><span class="token operator">/</span>path<span class="token punctuation">.</span>git
    $ npm install git<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token keyword">package</span><span class="token operator">/</span>path<span class="token punctuation">.</span>git#<span class="token number">0.1</span><span class="token number">.0</span>
<span class="token comment">//如果你希望，一个模块不管是否安装过，npm 都要强制重新安装，可以使用-f或--force参数。</span>
    $ npm install <span class="token operator">&lt;</span>packageName<span class="token operator">&gt;</span> <span class="token operator">--</span>force
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>1)install命令总是安装模块的最新版本，如果要安装模块的特定版本，可以在模块名后面加上@和版本号。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    $ npm install sax@latest
    $ npm install sax@<span class="token number">0.1</span><span class="token number">.1</span>
    $ npm install sax@<span class="token string">&quot;&gt;=0.1.0 &lt;0.2.0&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>2)如果使用--save-exact参数，会在package.json文件指定安装模块的确切版本。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    $ npm install readable<span class="token operator">-</span>stream <span class="token operator">--</span>save <span class="token operator">--</span>save<span class="token operator">-</span>exact
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>3)npm install默认会安装dependencies字段和devDependencies字段中的所有模块，如果使用--production参数，可以只安装dependencies字段的模块。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>                $ npm install <span class="token operator">--</span>production
                # 或者
                $ <span class="token constant">NODE_ENV</span><span class="token operator">=</span>production npm install
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong> 10、npm run</strong></p> <ul><li>1)npm run命令会自动在环境变量$PATH添加node_modules/.bin目录，所以scripts字段里面调用命令时不用加上路径，这就避免了全局安装NPM模块。</li> <li>2)npm run如果不加任何参数，直接运行，会列出package.json里面所有可以执行的脚本命令。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run build-js &amp;&amp; npm run build-css&quot;</span>
    <span class="token comment">//上面的写法是先运行npm run build-js，然后再运行npm run build-css，两个命令中间用&amp;&amp;连接。如果希望两个命令同时平行执行，它们中间可以用&amp;连接。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>  1）参数</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha test/&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//上面代码指定npm test，实际运行mocha test/。如果要通过npm test命令，将参数传到mocha，则参数之前要加上两个连词线。</span>
    $ npm run test <span class="token operator">--</span> anothertest<span class="token punctuation">.</span>js
    # 等同于
    $ mocha test<span class="token operator">/</span> anothertest<span class="token punctuation">.</span>js
    <span class="token comment">//上面命令表示，mocha要运行所有test子目录的测试脚本，以及另外一个测试脚本anothertest.js。</span>
    <span class="token comment">//npm run本身有一个参数-s，表示关闭npm本身的输出，只输出脚本产生的结果。</span>
    <span class="token comment">// 输出npm命令头</span>
    $ npm run test
    <span class="token comment">// 不输出npm命令头</span>
    $ npm run <span class="token operator">-</span>s test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>  2) npm-run-all</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    $ npm install npm<span class="token operator">-</span>run<span class="token operator">-</span>all <span class="token operator">--</span>save<span class="token operator">-</span>dev
    <span class="token comment">//继发执行</span>
    $ npm<span class="token operator">-</span>run<span class="token operator">-</span>all build<span class="token operator">:</span>html build<span class="token operator">:</span>js
    <span class="token comment">//等同于</span>
    $ npm run build<span class="token operator">:</span>html <span class="token operator">&amp;&amp;</span> npm run build<span class="token operator">:</span>js

    <span class="token comment">//并行执行</span>
    $ npm<span class="token operator">-</span>run<span class="token operator">-</span>all <span class="token operator">--</span>parallel watch<span class="token operator">:</span>html watch<span class="token operator">:</span>js
    <span class="token comment">//等同于</span>
    $ npm run watch<span class="token operator">:</span>html <span class="token operator">&amp;</span> npm run watch<span class="token operator">:</span>js

    <span class="token comment">//混合执行</span>
    $ npm<span class="token operator">-</span>run<span class="token operator">-</span>all clean lint <span class="token operator">--</span>parallel watch<span class="token operator">:</span>html watch<span class="token operator">:</span>js
    <span class="token comment">//等同于</span>
    $ npm<span class="token operator">-</span>run<span class="token operator">-</span>all clean lint
    $ npm<span class="token operator">-</span>run<span class="token operator">-</span>all <span class="token operator">--</span>parallel watch<span class="token operator">:</span>html watch<span class="token operator">:</span>js

    <span class="token comment">//通配符</span>
    $ npm<span class="token operator">-</span>run<span class="token operator">-</span>all <span class="token operator">--</span>parallel watch<span class="token operator">:</span><span class="token operator">*</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li>3)start命令
  如果start脚本没有配置，npm start命令默认执行下面的脚本，前提是模块的根目录存在一个server.js文件。
$ node server.js</li> <li>4)dev脚本命令
  规定开发阶段所要做的处理，比如构建网页资源。</li> <li>5)serve脚本命令用于启动服务。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token string-property property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;live-server dist/ --port=9090&quot;</span>
    <span class="token comment">//上面命令启动服务，用的是live-server模块，将服务启动在9090端口，展示dist子目录。</span>

    live<span class="token operator">-</span>server模块有三个功能。
        <span class="token number">1</span><span class="token punctuation">)</span>启动一个<span class="token constant">HTTP</span>服务器，展示指定目录的index<span class="token punctuation">.</span>html文件，通过该文件加载各种网络资源，这是file<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>协议做不到的。
        <span class="token number">2</span><span class="token punctuation">)</span>添加自动刷新功能。只要指定目录之中，文件有任何变化，它就会刷新页面。
        <span class="token number">3</span><span class="token punctuation">)</span>npm run serve命令执行以后，自动打开浏览器。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>6)pre- 和 post- 脚本</li></ul> <p>   以npm run lint为例，执行这条命令之前，npm会先查看有没有定义prelint和postlint两个钩子，如果有的话，就会先执行npm run prelint，然后执行npm run lint，最后执行npm run postlint。</p> <p><strong> 11、内部变量</strong></p> <p>  scripts字段可以使用一些内部变量，主要是package.json的各种字段。
比如，package.json的内容是{&quot;name&quot;:&quot;foo&quot;, &quot;version&quot;:&quot;1.2.5&quot;}，那么变量npm_package_name的值是foo，变量npm_package_version的值是1.2.5。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;bundle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mkdir -p build/$npm_package_version/&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//-p 确保目录名称存在，如果目录不存在的就新创建一个。</span>
    <span class="token comment">//config字段也可以用于设置内部字段。</span>
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fooproject&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;reporter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xunit&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha test/ --reporter $npm_package_config_reporter&quot;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>1)通配符</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token operator">*</span> 匹配<span class="token number">0</span>个或多个字符
    <span class="token operator">?</span> 匹配<span class="token number">1</span>个字符
    <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span> 匹配某个范围的字符。如果该范围的第一个字符是<span class="token operator">!</span>或<span class="token operator">^</span>，则匹配不在该范围的字符。
    <span class="token operator">!</span><span class="token punctuation">(</span>pattern<span class="token operator">|</span>pattern<span class="token operator">|</span>pattern<span class="token punctuation">)</span> 匹配任何不符合给定的模式
    <span class="token operator">?</span><span class="token punctuation">(</span>pattern<span class="token operator">|</span>pattern<span class="token operator">|</span>pattern<span class="token punctuation">)</span> 匹配<span class="token number">0</span>个或<span class="token number">1</span>个给定的模式
    <span class="token operator">+</span><span class="token punctuation">(</span>pattern<span class="token operator">|</span>pattern<span class="token operator">|</span>pattern<span class="token punctuation">)</span> 匹配<span class="token number">1</span>个或多个给定的模式
    <span class="token operator">*</span><span class="token punctuation">(</span>a<span class="token operator">|</span>b<span class="token operator">|</span>c<span class="token punctuation">)</span> 匹配<span class="token number">0</span>个或多个给定的模式
    @<span class="token punctuation">(</span>pattern<span class="token operator">|</span>pat<span class="token operator">*</span><span class="token operator">|</span>pat<span class="token operator">?</span>erN<span class="token punctuation">)</span> 只匹配给定模式之一
    <span class="token operator">**</span> 如果出现在路径部分，表示<span class="token number">0</span>个或多个子目录。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong> 12、npm link</strong></p> <p>  npm link就能起到这个作用，会自动建立这个符号链接。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token number">1</span>、在模块目录（src<span class="token operator">/</span>myModule）下运行npm link命令。
        npm link 
    <span class="token comment">//会在NPM的全局模块目录内，生成一个符号链接文件，该文件的名字就是package.json文件中指定的模块名。</span>
    <span class="token comment">//这个时候，已经可以全局调用myModule模块了。但是，如果我们要让这个模块安装在项目内，还要进行下面的步骤。</span>
    <span class="token number">2</span>、切换到项目目录，再次运行npm link命令，并指定模块名。
        npm link studynotes
    <span class="token number">3</span>、然后，就可以在你的项目中，加载该模块了。
        <span class="token keyword">var</span> myModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'studynotes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token number">4</span>、如果你的项目不再需要该模块，可以在项目目录内使用
    npm unlink命令，删除符号链接。
        npm unlink studynotes<span class="token comment">//删除固定模块的符号链接</span>
        npm unlink 删除全局符号链接
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong> 13、npm bin</strong></p> <p>  npm bin命令显示相对于当前目录的，Node模块的可执行脚本所在的目录（即.bin目录）。</p> <p><strong> 14、npm adduser</strong></p> <p>  npm adduser用于在npmjs.com注册一个用户。</p> <p><strong> 15、npm publish</strong></p> <p>  npm publish用于将当前模块发布到npmjs.com。执行之前，需要向npmjs.com申请用户名。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    $ npm adduser
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>  如果已经注册过，就使用下面的命令登录。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    $ npm login
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>  登录以后，就可以使用npm publish命令发布。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    $ npm publish
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>  如果当前模块是一个beta版，比如1.3.1-beta.3，那么发布的时候需要使用tag参数，将其发布到指定标签，默认的发布标签是latest。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    $ npm publish <span class="token operator">--</span>tag beta
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>  如果你的模块是用ES6写的，那么发布的时候，最好转成ES5。首先，需要安装Babel。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev babel<span class="token operator">-</span>cli@<span class="token number">6</span> babel<span class="token operator">-</span>preset<span class="token operator">-</span>es2015@<span class="token number">6</span>
    <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel source --presets babel-preset-es2015 --out-dir distribution&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;prepublish&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run build&quot;</span>
    <span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>  运行上面的脚本，会将source目录里面的ES6源码文件，转为distribution目录里面的ES5源码文件。然后，在项目根目录下面创建两个文件.npmignore和.gitignore，分别写入以下内容。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">// .npmignore</span>
    source
    <span class="token comment">// .gitignore</span>
    node_modules
    distribution 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong> 16、npm deprecate</strong></p> <p>  废弃某个版本的模块。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    $ npm deprecate my<span class="token operator">-</span>thing@<span class="token string">&quot;&lt; 0.2.3&quot;</span> <span class="token string">&quot;critical bug fixed in v0.2.3&quot;</span>
    <span class="token comment">//运行上面的命令以后，小于0.2.3版本的模块的package.json都会写入一行警告，用户安装这些版本时，这行警告就会在命令行显示。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong> 17、npm owner</strong></p> <p>  模块的维护者可以发布新版本。npm owner命令用于管理模块的维护者。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">//列出指定模块的维护者</span>
    $ npm owner ls <span class="token operator">&lt;</span><span class="token keyword">package</span> name<span class="token operator">&gt;</span>
    <span class="token comment">//新增维护者</span>
    $ npm owner add <span class="token operator">&lt;</span>user<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token keyword">package</span> name<span class="token operator">&gt;</span>
    <span class="token comment">//删除维护者</span>
    $ npm owner rm <span class="token operator">&lt;</span>user<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token keyword">package</span> name<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong> 18、npm outdated</strong></p> <p>  npm outdated命令检查当前项目所依赖的模块，是否已经有新版本。
它会输出当前版本（current version）、应当安装的版本（wanted version）和最新发布的版本（latest version）。</p> <h2 id="第三节-其它"><a href="#第三节-其它" class="header-anchor">#</a> 第三节 其它</h2> <p><strong>nrm:镜像源管理工具工具</strong></p> <ul><li>1、nrm ls 查看当前镜像源列表。</li> <li>2、nrm add key value 添加镜像源</li> <li>3、nrm use key 选择使用镜像源</li></ul> <p><strong>多文件上传包——formidable</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> form<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;formidable&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/4/2020, 10:33:20 AM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/articles/node/egg源码实现.html">
        egg源码实现
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.1db59d1a.js" defer></script><script src="/blog/assets/js/2.b41a7aaa.js" defer></script><script src="/blog/assets/js/1.844c5b44.js" defer></script><script src="/blog/assets/js/189.1ff9e7fd.js" defer></script>
  </body>
</html>
